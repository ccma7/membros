<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carteirinha Web</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    #loginContainer {
      text-align: center;
    }
    #carteirinha {
      display: none;
      width: 350px;
      border: 2px solid #333;
      border-radius: 10px;
      padding: 15px;
      background: #fff;
    }
    h2 {
      text-align: center;
      color: #007BFF; /* azul do título */
    }
    p {
      margin: 5px 0;
      font-size: 14px;
    }
    b {
      font-weight: bold;
    }
    #idText {
      color: #007BFF; /* azul no ID */
      font-weight: bold;
    }
    #validadeText {
      color: #8B0000; /* vermelho escuro */
      font-weight: bold;
    }
    #foto {
      display: block;
      margin: 0 auto 10px auto;
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #333;
    }
    button {
      display: block;
      width: 100%;
      margin-top: 10px;
      padding: 8px;
      border: none;
      border-radius: 5px;
      background: #007BFF;
      color: #fff;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div id="loginContainer">
    <h2>Login</h2>
    <div id="g_id_onload"
         data-client_id="SEU_CLIENT_ID"
         data-callback="handleCredentialResponse">
    </div>
    <div class="g_id_signin" data-type="standard"></div>
  </div>

  <div id="carteirinha">
    <h2>Carteirinha</h2>
    <img id="foto" src="" alt="Foto do usuário">
    <p><b>ID:</b> <span id="idText"></span></p>
    <p><b>Nome:</b> <span id="nomeText"></span></p>
    <p><b>Nascimento:</b> <span id="nascText"></span></p>
    <p><b>Endereço:</b> <span id="enderecoText"></span></p>
    <p><b>Função:</b> <span id="funcaoText"></span></p>
    <p><b>Idade:</b> <span id="idadeText"></span></p>
    <p><b>Email:</b> <span id="emailText"></span></p>
    <p><b>Status:</b> <span id="statusText"></span></p>
    <p><b>Validade:</b> <span id="validadeText">31/12/2024</span></p>
    <button onclick="baixarPDF()">Baixar PDF</button>
    <button onclick="logout()">Sair</button>
  </div>

  <script>
    let membros = [];
    let membroAtual = null;

    // Função para gerar ID sequencial automático
    function gerarIdSequencial(email, index) {
      return String(index + 1).padStart(3, '0');
    }

    // Carrega a planilha
    fetch("https://docs.google.com/spreadsheets/d/SEU_ID_DA_PLANILHA/gviz/tq?tqx=out:json")
      .then(res => res.text())
      .then(txt => {
        const json = JSON.parse(txt.substr(47).slice(0, -2));
        membros = json.table.rows.map((r, i) => ({
          nome: r.c[0]?.v || "",
          nascimento: r.c[1]?.v || "",
          endereco: r.c[2]?.v || "",
          funcao: r.c[3]?.v || "",
          idade: r.c[4]?.v || "",
          email: r.c[5]?.v || "",
          status: r.c[6]?.v || "",
          foto: r.c[7]?.v || "",
          validade: r.c[8]?.v || "31/12/2024",
          id: gerarIdSequencial(r.c[5]?.v, i)
        }));
      });

    // Login Google
    function handleCredentialResponse(response) {
      const data = jwt_decode(response.credential);
      const emailGoogle = data.email;
      const fotoGoogle = data.picture;

      const m = membros.find(x => x.email === emailGoogle);
      if (!m) {
        alert("Email não autorizado!");
        return;
      }

      membroAtual = m;
      document.getElementById('loginContainer').style.display = "none";
      document.getElementById('carteirinha').style.display = "block";

      document.getElementById('idText').innerText = m.id;
      document.getElementById('nomeText').innerText = m.nome;
      document.getElementById('nascText').innerText = m.nascimento;
      document.getElementById('enderecoText').innerText = m.endereco;
      document.getElementById('funcaoText').innerText = m.funcao;
      document.getElementById('idadeText').innerText = m.idade;
      document.getElementById('emailText').innerText = m.email;
      document.getElementById('statusText').innerText = m.status;
      document.getElementById('validadeText').innerText = m.validade;
      document.getElementById('foto').src = m.foto || fotoGoogle;
    }

  // Baixar PDF (logo abaixo das informações)
  function baixarPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    // Título
    doc.setFontSize(18);
    doc.setTextColor(0, 123, 255);
    doc.text("Carteirinha", 105, 20, null, null, "center");

    // Dados do usuário
    doc.setFontSize(12);
    doc.setTextColor(0, 0, 0);
    let y = 40; // posição inicial
    doc.text(`Nome: ${membroAtual.nome}`, 20, y); y += 10;
    doc.text(`Nascimento: ${membroAtual.nascimento}`, 20, y); y += 10;
    doc.text(`Endereço: ${membroAtual.endereco}`, 20, y); y += 10;
    doc.text(`Função: ${membroAtual.funcao}`, 20, y); y += 10;
    doc.text(`Idade: ${membroAtual.idade}`, 20, y); y += 10;
    doc.text(`Email: ${membroAtual.email}`, 20, y); y += 10;
    doc.text(`Status: ${membroAtual.status}`, 20, y); y += 10;

    // ID em azul
    doc.setTextColor(0, 123, 255);
    doc.text(`ID: ${membroAtual.id}`, 20, y); y += 10;

    // Validade em vermelho escuro
    doc.setTextColor(139, 0, 0);
    doc.text(`Validade: ${membroAtual.validade}`, 20, y);
    y += 20;

    // Foto/logo abaixo das informações
    const foto = document.getElementById('foto').src;
    if (foto) {
      doc.addImage(foto, "JPEG", 70, y, 70, 70); // centralizado abaixo das infos
    }

    // Salvar PDF
    doc.save("carteirinha.pdf");
  }

    function logout() {
      membroAtual = null;
      document.getElementById('carteirinha').style.display = "none";
      document.getElementById('loginContainer').style.display = "block";
    }

    // Decodificar JWT Google
    function jwt_decode(token) {
      return JSON.parse(atob(token.split('.')[1]));
    }
  </script>
</body>
</html>
