<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Carteirinha + Dashboard com Google Login</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
body { font-family: Arial; background: #f0f0f0; display:flex; justify-content:center; padding:20px; flex-direction:column; align-items:center;}
.container { background:white; padding:20px; border-radius:12px; box-shadow:0 5px 15px rgba(0,0,0,0.2); width:350px; text-align:center; margin-bottom:20px;}
button { padding:10px 20px; border:none; border-radius:6px; background:#0097b2; color:white; cursor:pointer; font-weight:bold; margin:2px; }
button:hover { background:#00758a; }
img { max-width:120px; border-radius:50%; margin:10px 0; }
#carteirinha, #dashboard { display:none; }
table { width:100%; border-collapse:collapse; margin-top:10px;}
th, td { border:1px solid #ccc; padding:6px; text-align:center;}
</style>
</head>
<body>

<div class="container" id="loginContainer">
<h2>Login com Google</h2>
<div id="g_id_onload"
     data-client_id="865470145994-cv9p33gvuoa05kt2m9gbs3rs0vrto4db.apps.googleusercontent.com"
     data-context="signin"
     data-ux_mode="popup"
     data-login_uri=""
     data-auto_prompt="false">
</div>
<div class="g_id_signin" data-type="standard"></div>
</div>

<!-- Carteirinha do Membro -->
<div class="container" id="carteirinha">
<h2 id="nome">Nome</h2>
<img id="foto" src="" alt="Foto do Membro">
<p id="cargo">Cargo</p>
<button onclick="gerarPDFMembro()">Gerar PDF</button>
<button onclick="logout()">Sair</button>
</div>

<!-- Dashboard do Admin -->
<div class="container" id="dashboard">
<h2>Dashboard do Admin</h2>
<p>Aqui você pode gerenciar membros (simulado)</p>
<button onclick="logout()">Sair</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
let membroAtual = null;

// Lista de emails de admin (substitua pelos seus)
const admins = ["seuemail@gmail.com"];

// Função chamada pelo Google após login
function handleCredentialResponse(response) {
    const data = parseJwt(response.credential);
    const email = data.email;
    const nome = data.name;
    const foto = data.picture;

    if(admins.includes(email)){
        document.getElementById('loginContainer').style.display="none";
        document.getElementById('dashboard').style.display="block";
    } else {
        membroAtual = {nome, foto, cargo:"Aluno"}; // Cargo fixo ou você pode buscar em planilha
        document.getElementById('loginContainer').style.display="none";
        document.getElementById('carteirinha').style.display="block";
        document.getElementById('nome').innerText = membroAtual.nome;
        document.getElementById('foto').src = membroAtual.foto;
        document.getElementById('cargo').innerText = membroAtual.cargo;
    }
}

// Logout
function logout(){
    document.getElementById('loginContainer').style.display="block";
    document.getElementById('carteirinha').style.display="none";
    document.getElementById('dashboard').style.display="none";
    membroAtual=null;
}

// Gerar PDF da carteirinha
async function gerarPDFMembro(){
    if(!membroAtual) return;
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    doc.text(membroAtual.nome,20,20);
    doc.text(membroAtual.cargo,20,30);
    if(membroAtual.foto){ const img=await convertImgToBase64(membroAtual.foto); doc.addImage(img,'JPEG',20,40,50,50);}
    doc.save(`${membroAtual.nome}_carteirinha.pdf`);
}

// Converte imagem para base64
async function convertImgToBase64(url){
    const res=await fetch(url);
    const blob=await res.blob();
    return new Promise(resolve=>{const reader=new FileReader(); reader.onloadend=()=>resolve(reader.result); reader.readAsDataURL(blob);});
}

// Decodifica JWT do Google
function parseJwt (token) {
    var base64Url = token.split('.')[1];
    var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    var jsonPayload = decodeURIComponent(window.atob(base64).split('').map(function(c) {
        return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    return JSON.parse(jsonPayload);
}

// Inicializa botão de login Google
window.onload = function(){
    google.accounts.id.initialize({
        client_id: "SEU_CLIENT_ID_AQUI",
        callback: handleCredentialResponse
    });
    google.accounts.id.renderButton(
        document.querySelector(".g_id_signin"),
        { theme: "outline", size: "large" }
    );
    google.accounts.id.prompt();
};
</script>
</body>
</html>
